(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-950cdaca"],{"0d4a":function(t,e,n){"use strict";n.r(e);var o=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{ref:"mainPanel",staticClass:"mainPanel"},[n("div",{staticClass:"tablePanel",style:{height:t.tableHeight+"px"}},[n("el-table",{staticClass:"tableGrow",staticStyle:{width:"100%"},attrs:{data:t.dataList,height:"100%"}},[n("el-table-column",{attrs:{label:"操作","min-width":"80",fixed:""},scopedSlots:t._u([{key:"default",fn:function(e){return[n("el-button",{attrs:{type:"text",disabled:e.row.assigners.length>0},on:{click:function(n){return t.handleAssign(e.row)}}},[t._v(" 指派 ")])]}}])}),n("el-table-column",{attrs:{prop:"id",label:"工单号","show-overflow-tooltip":"","min-width":"260"},scopedSlots:t._u([{key:"default",fn:function(e){return[n("el-link",{attrs:{type:"primary"},on:{click:function(n){return t.handleDetail(e.row)}}},[t._v(t._s(e.row.id))])]}}])}),n("el-table-column",{attrs:{prop:"title",label:"标题","show-overflow-tooltip":"","min-width":"200"}}),n("el-table-column",{attrs:{prop:"customerName",label:"客户名称","min-width":"140"}}),n("el-table-column",{attrs:{prop:"contactName",label:"联系人名称","min-width":"140"}}),n("el-table-column",{attrs:{prop:"contactPhone",label:"联系人电话","min-width":"140"}}),n("el-table-column",{attrs:{prop:"address","show-overflow-tooltip":"",label:"服务地址","min-width":"180"}}),n("el-table-column",{attrs:{prop:"category","show-overflow-tooltip":"",label:"服务项目","min-width":"180"}}),n("el-table-column",{attrs:{prop:"appointsTime",label:"预约时间","min-width":"160"}}),n("el-table-column",{attrs:{prop:"priority",label:"工单优先级","min-width":"140"}}),n("el-table-column",{attrs:{prop:"label","show-overflow-tooltip":"",label:"工单标签","min-width":"180"},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v(t._s(e.row.label.toString()))]}}])})],1)],1),n("div",{staticClass:"pagePanel"},[n("el-pagination",{attrs:{background:"","current-page":t.pageInfo.pageNum,"page-sizes":[10,20,30,40],"page-size":t.pageInfo.pageSize,layout:"total, sizes, prev, pager, next, jumper",total:t.total},on:{"update:currentPage":function(e){return t.$set(t.pageInfo,"pageNum",e)},"update:current-page":function(e){return t.$set(t.pageInfo,"pageNum",e)},"update:pageSize":function(e){return t.$set(t.pageInfo,"pageSize",e)},"update:page-size":function(e){return t.$set(t.pageInfo,"pageSize",e)},"size-change":t.handleSizeChange,"current-change":t.handleCurrentChange}})],1),n("el-dialog",{attrs:{title:"指派工单",width:"60%",visible:t.dialogFormVisible},on:{"update:visible":function(e){t.dialogFormVisible=e}}},[n("el-table",{staticClass:"tableGrow",attrs:{data:t.assignPerson,height:"300px"}},[n("el-table-column",{attrs:{label:"指派","min-width":"80",fixed:""},scopedSlots:t._u([{key:"default",fn:function(e){return[n("el-checkbox",{model:{value:e.row.assign,callback:function(n){t.$set(e.row,"assign",n)},expression:"scope.row.assign"}})]}}])}),n("el-table-column",{attrs:{prop:"name",label:"姓名","show-overflow-tooltip":"","min-width":"140"}}),n("el-table-column",{attrs:{prop:"distance",label:"工单距离","min-width":"160"}}),n("el-table-column",{attrs:{prop:"phone",label:"电话","min-width":"140"}}),n("el-table-column",{attrs:{prop:"team",label:"服务团队","min-width":"140"}}),n("el-table-column",{attrs:{prop:"incompleteNum",label:"未完成工单","min-width":"140"}})],1),n("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[n("el-button",{attrs:{size:"small"},on:{click:function(e){t.dialogFormVisible=!1}}},[t._v("取 消")]),n("el-button",{attrs:{size:"small",type:"primary",loading:t.loading},on:{click:t.confirm}},[t._v("确 定")])],1)],1)],1)},a=[],i=n("b85c"),s=n("5530"),l=(n("ac1f"),n("841c"),n("a15b"),n("d81d"),n("99af"),n("b0c0"),n("d3b7"),n("2f62")),r=n("0cd6"),c=n.n(r),u=n("ed08"),d={components:{},filters:{},data:function(){return{pageInfo:{pageNum:1,pageSize:10},total:0,dataList:[],tableHeight:0,searchForm:{id:""},dialogFormVisible:!1,currentRow:null,loading:!1}},computed:Object(s["a"])({},Object(l["b"])(["orderList","assignPerson","userInfo","corpId"])),created:function(){console.log("AutoConsole: assignPerson",this.assignPerson),this.getList()},mounted:function(){var t=this;this.tableHeight=this.$refs.mainPanel.clientHeight-90,window.onresize=function(){return function(){t.tableHeight=t.$refs.mainPanel.clientHeight-90}()}},beforeDestroy:function(){window.onresize=null},methods:{paging:function(t,e,n){if(!t)return[];var o=c.a.drop(t,n*(e-1)),a=c.a.take(o,n);return a},handleSizeChange:function(t){this.pageInfo.pageNum=1,this.getList()},handleCurrentChange:function(t){this.pageInfo.pageNum=t,this.getList()},search:function(){this.pageInfo.pageNum=1,this.getList()},resetForm:function(){this.$refs.searchForm.resetFields(),this.search()},popoverResetForm:function(){this.$refs.popoverForm.resetFields(),this.search()},getList:function(){this.dataList=this.paging(this.orderList,this.pageInfo.pageNum,this.pageInfo.pageSize),this.total=this.orderList.length},handleDetail:function(t){this.$router.push({name:"WorkOrderDetail",params:{id:t.id}})},handleAssign:function(t){this.currentRow=t;var e=this;if(this.$dd)try{this.$dd.ready((function(){console.log("DDJSAPI初始化完成"),e.$dd.biz.contact.choose({multiple:!1,users:[],corpId:e.corpId,max:1,onSuccess:function(t){console.log("AutoConsole: handleAssign -> data",t);var n,o=[],a=Object(i["a"])(t);try{for(a.s();!(n=a.n()).done;){var s=n.value;e.currentRow.assigners.push(s),o.push(s.name)}}catch(l){a.e(l)}finally{a.f()}console.log("AutoConsole: handleAssign -> self.currentRow",e.currentRow),e.$http.post("/biz/sendWorkNotification",{userIdList:t.map((function(t){return t.emplId})).join(","),content:"工单号：".concat(e.currentRow.id,"\n工单标题：").concat(e.currentRow.title,"\n您有一笔新的工单，请及时处理！")}),e.currentRow.assigners.length&&(e.$store.commit("demo/UPDATE_ORDERLIST",e.currentRow),e.$store.commit("demo/UPDATE_LOGOBJ",{title:"指派工单",date:Object(u["b"])(new Date),des:"".concat(e.userInfo.name,"将工单指派给[").concat(o.toString(),"]"),orderId:e.currentRow.id})),e.getList()},onFail:function(t){console.log(t)}})}))}catch(n){console.log(n)}},confirm:function(){this.loading=!0;var t,e=[],n=Object(i["a"])(this.assignPerson);try{for(n.s();!(t=n.n()).done;){var o=t.value;o.assign&&(this.currentRow.assigners.push(o),e.push(o.name))}}catch(a){n.e(a)}finally{n.f()}this.currentRow.assigners.length&&(this.$store.commit("demo/UPDATE_ORDERLIST",this.currentRow),this.$store.commit("demo/UPDATE_LOGOBJ",{title:"指派工单",date:Object(u["b"])(new Date),des:"系统管理员将工单指派给[".concat(e.toString(),"]"),orderId:this.currentRow.id})),this.dialogFormVisible=!1,this.loading=!1,this.getList()}}},p=d,h=(n("eaa2"),n("2877")),g=Object(h["a"])(p,o,a,!1,null,"2ed50aa7",null);e["default"]=g.exports},"4db2":function(t,e,n){},eaa2:function(t,e,n){"use strict";n("4db2")}}]);
//# sourceMappingURL=chunk-950cdaca.0540448c.js.map